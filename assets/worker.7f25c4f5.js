(function(){"use strict";function $({width:e}){return function(r,o){return(o*e+r)*4}}const Y=(e,t,r,o,n)=>{const a=$(e),c=$(t),s=t.width*t.height;let i=0,l=0,h=0,w=0,d=0;for(let j=0,Q=t.height;j<Q;j++)for(let C=0,Z=t.width;C<Z;C++){const x=n(e,a(r+C,o+j)),O=n(t,c(C,j));i+=x**2,l+=x,h+=O**2,w+=O,d+=x*O}const b=l/s,_=w/s,E=d/s,g=i/s,y=h/s,F=E-b*_,M=g-b**2,K=y-_**2,X=Math.sqrt(M)*Math.sqrt(K);return X===0?1:F/X},G=(e,t)=>e.data[t]*.3+e.data[t+1]*.59+e.data[t+2]*.11;function*I(e,t,r,o){for(let n=r;n<o;++n)for(let a=e;a<t;++a)yield{pos:{x:a,y:n},meta:{}}}function*S(e,t){yield*I(t.offsetX,e.width+-t.originW,t.offsetY,e.height+-t.originH)}function H(e,t,r,o,n,a){const c=a();for(const s of n()){const i=r(e,t,s.pos.x,s.pos.y,o);c.retrieve(s,i)}return c}var A=function(e,t,r,o,n){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?n.call(e,r):n?n.value=r:t.set(e,r),r},m=function(e,t,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(e):o?o.value:t.get(e)},P,v,T;class U{constructor(t,r){P.set(this,void 0),v.set(this,[]),T.set(this,void 0),A(this,T,t,"f"),A(this,P,r,"f")}retrieve(t,r){var o,n;const a=m(this,T,"f").call(this,((o=t.meta.scores)!==null&&o!==void 0?o:[]).concat(r));if(a>m(this,P,"f")){const c=structuredClone(t),s=(n=c.meta.scores)!==null&&n!==void 0?n:[];s.push(a),c.meta.scores=s,m(this,v,"f").push(c)}}first(){const t=m(this,v,"f")[0];if(!t)throw new Error("something wrong: result is empty");return t}all(){return m(this,v,"f").slice()}}P=new WeakMap,v=new WeakMap,T=new WeakMap;function*R(e,t){for(const r of t){const o=r.pos.x+e.x,n=r.pos.y+e.y;yield Object.assign(Object.assign({},r),{pos:{x:o,y:n}})}}var W=function(e,t,r,o,n){if(o==="m")throw new TypeError("Private method is not writable");if(o==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return o==="a"?n.call(e,r):n?n.value=r:t.set(e,r),r},f=function(e,t,r,o){if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?o:r==="a"?o.call(e):o?o.value:t.get(e)},p,u;class q{constructor(t,r){p.set(this,void 0),u.set(this,void 0),W(this,u,t,"f"),W(this,p,r,"f")}retrieve(t,r){return f(this,p,"f").retrieve(t,r)}first(){const t=f(this,p,"f").first();if(!t)throw new Error("something wrong: result is empty");return Object.assign(Object.assign({},t),{pos:{x:t.pos.x-f(this,u,"f").x,y:t.pos.y-f(this,u,"f").y}})}all(){return f(this,p,"f").all().map(t=>Object.assign(Object.assign({},t),{pos:{x:t.pos.x-f(this,u,"f").x,y:t.pos.y-f(this,u,"f").y}}))}}p=new WeakMap,u=new WeakMap;function B(e){if(e.length===0)return 0;let t=0,r=!1;for(const o of e)Number.isFinite(o)?t+=o:r=!0;return r&&console.error(`average takes some non-finite value: ${e.join(", ")}`),t/e.length}function L(e,t,r,o,n,a,c){const s=a(t);let i=[];for(const l of s){const h={x:l.offsetX,y:l.offsetY};if(i=H(e,l.data,r,o,()=>l===s[0]?R(h,S(e,l)):R(h,i),()=>new q(h,new U(B,n))).all(),c==null||c(i),i.length===1&&i[0])return i}return i}function N(e,t){if(t*4>e.length)throw new Error(`out of bounds - current: ${t*4}...${t*4+3}, length: ${e.length}`);return{r:e[t*4],g:e[t*4+1],b:e[t*4+2],a:e[t*4+3]}}function V(e,t,r){var o;if(t*4>e.length)throw new Error(`out of bounds - current: ${t*4}...${t*4+3}, length: ${e.length}`);e[t*4]=r.r,e[t*4+1]=r.g,e[t*4+2]=r.b,e[t*4+3]=(o=r.a)!==null&&o!==void 0?o:255}function J(e,t){const r=e.width,o=e.height,n=Math.ceil(r/t),a=Math.ceil(o/t);let c=[];for(let s=0;s<n;s++)for(let i=0;i<a;i++){const l=o%t>0&&i===a-1,h=r%t>0&&s===n-1,w=l?o%t:t,d=h?r%t:t,b=i*t,_=s*t,E=new Uint8ClampedArray(d*w*4);for(let g=0;g<w;++g)for(let y=0;y<d;++y){const F=g*d+y,M=(g+b)*e.width+(y+_);V(E,F,N(e.data,M))}c.push({data:new ImageData(E,d,w),offsetX:_,offsetY:b,originH:e.height,originW:e.width})}return c}onmessage=e=>{const{base:t,temp:r}=e.data,o=L(new ImageData(new Uint8ClampedArray(t.data),t.width,t.height),new ImageData(new Uint8ClampedArray(r.data),r.width,r.height),Y,G,.95,n=>J(n,24));postMessage(o)}})();

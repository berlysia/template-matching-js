(function(){"use strict";function P({width:t}){return function(o,n){return(n*t+o)*4}}const M=(t,e,o,n,r)=>{const c=P(t),m=P(e),a=e.width*e.height;let w=0,l=0,i=0,s=0,E=0;for(let u=0,z=e.height;u<z;u++)for(let f=0,B=e.width;f<B;f++){const y=r(t,c(o+f,n+u)),g=r(e,m(f,u));w+=y**2,l+=y,i+=g**2,s+=g,E+=y*g}const C=l/a,_=s/a,v=E/a,G=w/a,L=i/a,D=v-C*_,U=G-C**2,q=L-_**2,S=Math.sqrt(U)*Math.sqrt(q);return S===0?1:D/S},A=(t,e)=>t.data[e]*.3+t.data[e+1]*.59+t.data[e+2]*.11;function p(t,e,o){return t<=e?e:t>=o?o-1:t}function d(t,e=1,o=0){return Math.tanh(((t+o)*e/2+1)/2)}const h=10,T=.2,b=.6;function x(t,e,o){const r=(t-e)/(o-e)*2-1;return{r:p(Math.floor(d(r,h,-1*T)*255),0,256),g:p(Math.floor((d(r,h,b)-d(r,h,-b))*255),0,256),b:p(Math.floor((1-d(r,h,T))*255),0,256)}}function F(t){return x(t,0,1)}function j(t,e,o,n){const r=new Uint8ClampedArray(t.height*t.width*4);for(let c=0,m=t.height-e.height;c<m;++c)for(let a=0,w=t.width-e.width;a<w;++a){const l=o(t,e,a,c,n),i=(c*t.width+a)*4,s=F(l);r[i]=s.r,r[i+1]=s.g,r[i+2]=s.b,r[i+3]=255}return new ImageData(r,t.width,t.height)}onmessage=t=>{const{base:e,temp:o}=t.data,n=j(new ImageData(new Uint8ClampedArray(e.data),e.width,e.height),new ImageData(new Uint8ClampedArray(o.data),o.width,o.height),M,A);postMessage({data:n.data.buffer,width:n.width,height:n.height},[n.data.buffer])}})();
